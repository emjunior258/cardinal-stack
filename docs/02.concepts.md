# Core Concepts

## Network
Networks are representations of Mobile Network operators that the platform is capable of interacting to.

## Short codes
Short codes are numbers that can be used to dial USSD applications. Each short code is bound to one or more mobile network operators.

## Space
A logical separation inside the platform, allowing segregation of configurations/objects. The following objects belong a space:

* Key Pairs
* Certificate issuers
* Applications
* Upstream Endpoint
* Short Lists

A space is assigned entitlements, which are resouces that can be used within the same. There 2 kinds of entitlements that can be assigned to a space:

* **Short codes** - USSD short codes that the space can handle traffic from.

* **Networks** - The Mobile networks that the space can handle traffic from. Each Network entitlement defines whether the space is allowed or not to send USSD pushes or not,

## Key Pairs
Key pairs are assymetric keys that can be used by the platform to securely authenticate itself when interacting with application endpoints. Key Pairs are space scoped.

## Certificate issuers
Certificate issues are Certificate Authorities that the platform trusts that may issue certificates used to authenticate applications when interacting with the platform. Certificate issuers are space scoped.

## Application
Represents a USSD service.
An application is composed is composed of:

* **Backends**
* **Entry points**
* **Error Messages**

An application may or may not be allowed access to user location data.

An application selects a Key Pair to be used by the platform to authenticate on Backend.

An application may choose to enable/disable caching.

The Application error messages are overrides to the platform default error messages, meant to be output whenever the platform encounters an error.

## Backend
A backend service that implements USSD application logic. An HTTP URL is specified to reach the backend.

## USSD Session
A session represents a USSD Interaction in the platform. A session is created when a USSD interaction starts and is destroyed when the interaction ends. The platform stores the session data in a persistent data structure.

Every session has a unique identifier and is bound to an MSISDN and a specific Mobile network.

A session goes through the following statuses:

* **Active** - The session is active and the user is currently interacting with the application.
* **Cancelled** - The session was cancelled by the user.
* **Completed** - The session has completed successfully
* **Crashed** - The session has crashed due to an application error
* **Expired** - The session has expired due to inactivity
* **Terminated** - The session has been explicity terminated by the mobile network operator

There are two kinds of sessions:

* **Dial session** - The session was initiated by dialing a USSD code.
* **Push session** - The session was initiated by an application initiated USSD push.

## Activity
An Activity is a screen that is presented to the end user. Each Activity has a well defined unique Identifier. Examples: login, main-menu, transfer.
Activities are discovered by the platform dynamically via the Application Map.



## Short list
A list of MSISDNs that can be used for segregation.

## Entry point
Represents a trigger to initiate a USSD session/interaction. There are two kinds of Entry points:

* **Dial** - session is initiated by dialing a specific short code.
* **Push** - session is initiated by the Application via a Push.

An entry-point specified the Networks on which it is available and it specifies an Upstream Endpoint.

An entry point must define the Backend that implements the USSD application logic.

An Entry point can have an associated short list associated to it, restricting its usage to the MSISDNs contained in the Short List.

An entry-point may define the Identifier of the Initial/first activity, allowing the platform to pull it from cache if it exists. If there is no initial activity defined, the platform will use the default activity id which is "main".

An entry-point may have 2 backends bound to it as long as one of the backends has a short list bound it.

A short list can be associated directly to an entry point, restricting its usage to the MSISDNs contained in the Short List. When associating a short list to an entry point an exclusion message MUST be defined, which is essentially a message to be displayed to customers that are not part of the short list.

### Dial Entry Point

A Dial entry point is an entry point bound to a Short code that is used to access the USSD application. A Dial entry point responds to the Dialing of USSD codes matching the short code.

A Dial entry point may define a prefix to be expected after the short code and a number of parameters that it expects to receive upon dialing. Prefix and parameters are the additional tokens provided after the short code, separated by the `*` symbol. The parameters that appear to the right can be marked as optional, allowing them to be omitted during the dialing process.

**USSD code format**: `*{ShortCode}*{prefix?}*{param1?}*{param2?}*{paramN?}#`.

Example USSD codes:
* `*123#`
* `*123*01#`
* `*123*02*1010#`
* `*123*10*21*1000#`

Each parameter defined in the USSD Code Format MUST be mapped to a session key, which is used to store the value of the parameter in the session, allowing the backend to receive and use the value of the parameter when handling a request.

There can be multiple Dial Entry points bound to the same Short code as long they are assigned different/non-conflicting USSD Code formats.

A suspension can be defined on a **Dial** entry-point defining message to be displayed to customers when attempting to access it.


### Push Entry Point

A Push entry point initiates a USSD push session.

An Entry point of this kind may define arbitrary data to be populated in the User session.

This kind of entry point requires a Certificate issuer to authenticate the application backend whenever it calls the platform to trigger USSD push. More than specifying the Certificate issuer MUST also specify the authorized certificate common names.


## Application Map
A definition of all the Screens/Activities that are part of a USSD application with indication of context values required to fulfill each of them and the caching configurations for each. The Application map is served by the Application backend.

### Activity Context
The definition of context values required to fulfill an Activity is just an array of strings, which are the keys of session data values to be passed to the backend.  The Context also defined whether the activity expects to receive user location or not. In addition to passing down the session data and user location, the platform will also provide the following data to the backend when performing a USSD Request:
* `application.id` - The unique ID of the application in the platform
* `application.entrypoint.id` - The ID of the application entry point
* `user.input` - The short code dialed by the user
* `user.msisdn` - The MSISDN of the user
* `session.network` - the ID of the mobile network
* `session.type` - The type of USSD session (one of: user_initiated, network_initiated)
* `session.id` - The unique identifier of the USSD session
* `request.id` - The unique identifier of the USSD request

### Activity Caching
The following cache settings can be defined for each Activity:

* `enabled` - Whether caching is enabled or not
* `maxAge` - The maximum age of the cache entry in seconds
* `scope` - The scope of the cache entry (one of: global, user).
* `variation key` - An optional session key that can be used to identify variations of content and cause the platforn to put a separate cache entry. This is particularly useful for Internationalization, because the same activity can be served in multiple languages.

## Input Traps
It's essentially a Map of user inputs to Activity ids. An input trap tells the platform which Activity to navigate to depending on the user input.
